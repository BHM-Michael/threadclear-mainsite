<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-left">
      <h1>Dashboard</h1>
      <span class="org-label">{{ currentOrg?.name }}</span>
    </div>
    <div class="header-right">
      <div class="period-selector">
        <select [(ngModel)]="selectedDays" (change)="onDaysChange(selectedDays)">
          <option [value]="7">Last 7 days</option>
          <option [value]="30">Last 30 days</option>
          <option [value]="90">Last 90 days</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="spinner"></div>
  </div>

  <!-- Main Content -->
  <ng-container *ngIf="!isLoading">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card card-total">
        <div class="card-header">
          <span class="card-label">Total Conversations</span>
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
            </svg>
          </div>
        </div>
        <div class="card-value">{{ summary?.TotalConversations || 0 }}</div>
      </div>

      <div class="summary-card card-high">
        <div class="card-header">
          <span class="card-label">High Risk</span>
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
          </div>
        </div>
        <div class="card-value">{{ summary?.HighRiskCount || 0 }}</div>
      </div>

      <div class="summary-card card-medium">
        <div class="card-header">
          <span class="card-label">Medium Risk</span>
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
        </div>
        <div class="card-value">{{ summary?.MediumRiskCount || 0 }}</div>
      </div>

      <div class="summary-card card-low">
        <div class="card-header">
          <span class="card-label">Low Risk</span>
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
        </div>
        <div class="card-value">{{ summary?.LowRiskCount || 0 }}</div>
      </div>

      <div class="summary-card card-health">
        <div class="card-header">
          <span class="card-label">Avg Health Score</span>
          <div class="card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
            </svg>
          </div>
        </div>
        <div class="card-value">{{ summary?.AverageHealthScore | number:'1.0-0' }}%</div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <!-- Conversation Trends -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Conversation Trends</h3>
        </div>
        <div class="trends-chart" *ngIf="trends.length > 0">
          <div class="trend-bar-wrapper" *ngFor="let trend of trends">
            <div class="trend-bar" [style.height.%]="(trend.ConversationCount / getMaxConversations()) * 100">
              <div class="trend-tooltip">{{ trend.ConversationCount }} conversations</div>
            </div>
            <span class="trend-label">{{ trend.Period | slice:5:10 }}</span>
          </div>
        </div>
        <div class="empty-state" *ngIf="trends.length === 0">
          <div class="empty-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" />
            </svg>
          </div>
          <div class="empty-title">No trend data</div>
          <div class="empty-subtitle">Analyze more conversations to see trends</div>
        </div>
      </div>

      <!-- By Source Type -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>By Source Type</h3>
        </div>
        <div class="source-list" *ngIf="getSourceTypes().length > 0">
          <div class="source-item" *ngFor="let source of getSourceTypes()">
            <div class="source-header">
              <span class="source-name">{{ source.key }}</span>
              <span class="source-count">{{ source.value }}</span>
            </div>
            <div class="source-bar-bg">
              <div class="source-bar" [style.width.%]="getSourcePercentage(source.value)"></div>
            </div>
          </div>
        </div>
        <div class="empty-state" *ngIf="getSourceTypes().length === 0">
          <div class="empty-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
          </div>
          <div class="empty-title">No source data</div>
          <div class="empty-subtitle">Sources will appear as you analyze</div>
        </div>
      </div>
    </div>

    <!-- Topics Section -->
    <div class="topics-section" *ngIf="topics.length > 0">
      <div class="section-header">
        <h3>Top Topics</h3>
      </div>
      <div class="topics-grid">
        <div class="topic-card" *ngFor="let topic of topics">
          <div class="topic-header">
            <span class="topic-name">{{ topic.Topic }}</span>
            <span class="topic-count">{{ topic.Count }}</span>
          </div>
          <div class="topic-categories" *ngIf="getTopCategories(topic).length > 0">
            <span class="category-tag" *ngFor="let cat of getTopCategories(topic)"
              [ngClass]="'severity-' + getTopicSeverity(topic)">
              {{ cat.key }}: {{ cat.value }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</div>